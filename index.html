<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CSV 編集表示</title>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<style>
body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif; background: #f8f9fa; margin: 0; padding: 20px; }
table { border-collapse: collapse; width: 100%; background: #fff; }
th, td { border: 1px solid #ccc; padding: 6px; }
th { background: #f1f3f5; }
</style>
</head>
<body>
<h3>CSV 編集後の表示</h3>
<div id="content">読み込み中...</div>

<script>
const CSV_URL = "output/autohome/135/config_135.ja.csv"; // ←ここだけ自分のCSVに変更

Papa.parse(CSV_URL, {
  download: true,
  header: true,
  skipEmptyLines: false,
  complete: (res) => {
    if (!res.data || !res.data.length) {
      document.getElementById("content").textContent = "CSVが空です。";
      return;
    }

    let fields = res.meta.fields.map(f => f.replace(/^\ufeff/, ""));
    // 「セクション」「項目」列を削除
    const drop = new Set(["セクション", "項目"]);
    const visibleFields = fields.filter(f => !drop.has(f));

    // 各セル処理
    const rows = res.data.map((r, i) => {
      for (const k in r) {
        const val = (r[k] || "").trim();
        if (val.toLowerCase() === "nan") r[k] = "";
      }
      if (i <= 2 && "セクション_ja" in r) r["セクション_ja"] = "";
      if (i === 0 && "項目_ja" in r) r["項目_ja"] = "";
      return r;
    });

    // 表生成
    let html = "<table><thead><tr>";
    visibleFields.forEach(f => html += `<th>${f}</th>`);
    html += "</tr></thead><tbody>";
    rows.forEach(r => {
      html += "<tr>";
      visibleFields.forEach(f => html += `<td>${r[f] || ""}</td>`);
      html += "</tr>";
    });
    html += "</tbody></table>";
    document.getElementById("content").innerHTML = html;
  },
  error: (err) => {
    document.getElementById("content").textContent = "読み込み失敗: " + err.message;
  }
});
</script>
</body>
</html>
